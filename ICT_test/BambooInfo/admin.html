<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理ページ</title>
    <style>
        body { font-family: sans-serif; margin: 2em; background-color: #f9f9f9; }
        .container { max-width: 900px; margin: auto; padding: 2em; background-color: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { color: #2c5a3b; border-bottom: 2px solid #2c5a3b; padding-bottom: 0.5em; }
        table { width: 100%; border-collapse: collapse; margin-top: 2em; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f2f2f2; font-weight: bold; }
        tbody tr:nth-child(even) { background-color: #f9f9f9; }
        .action-btn { padding: 0.5em 1em; color: white; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; margin-right: 5px; font-size: 0.9em; }
        .edit-btn { background-color: #1976d2; }
        .edit-btn:hover { background-color: #1565c0; }
        .delete-btn { background-color: #ef5350; }
        .delete-btn:hover { background-color: #d32f2f; }

        /* --- ハンバーガーメニュー --- */
        .menu-toggle { position: fixed; top: 15px; left: 15px; z-index: 1001; background: #fff; border: 1px solid #ddd; width: 45px; height: 45px; border-radius: 50%; font-size: 20px; cursor: pointer; color: #2c5a3b; }
        .nav-menu { position: fixed; top: 0; left: 0; width: 250px; height: 100%; background: #fff; box-shadow: 2px 0 5px rgba(0,0,0,0.1); transform: translateX(-100%); transition: transform 0.3s ease; z-index: 1000; padding-top: 60px; }
        .nav-menu.open { transform: translateX(0); }
        .nav-menu ul { list-style: none; padding: 0; margin: 0; }
        .nav-menu li a { display: block; padding: 15px 25px; color: #2c5a3b; text-decoration: none; font-size: 1em; border-bottom: 1px solid #f0f0f0; }
        .nav-menu li a:hover { background-color: #f2f2f2; }
    </style>
</head>
<body>

    <button id="menu-toggle" class="menu-toggle">三</button>
    <nav id="nav-menu" class="nav-menu">
        <ul></ul>
    </nav>

    <div class="container">
        <h1 id="admin-title">管理ページ</h1>
        <table>
            <thead>
                <tr>
                    <th>所在地</th>
                    <th>面積 (m²)</th>
                    <th>主な竹の種類</th>
                    <th>状態</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody id="bamboo-list"></tbody>
        </table>
    </div>

    <script>
        function setupHamburgerMenu() {
            const menuToggle = document.getElementById('menu-toggle');
            const navMenu = document.getElementById('nav-menu');
            if (!menuToggle || !navMenu) return;
            const menuList = navMenu.querySelector('ul');
            const loggedInUser = sessionStorage.getItem('loggedInUser');
            menuToggle.addEventListener('click', () => navMenu.classList.toggle('open'));
            let menuItemsHTML = `<li><a href="read.html">みんなの投稿を見る</a></li><li><a href="index.html">新しい情報を登録する</a></li>`;
            if (loggedInUser) {
                menuItemsHTML = `<li><a href="mypage.html">マイページ (${loggedInUser})</a></li>` + menuItemsHTML + `<hr><li><a href="#" id="logout-link">ログアウト</a></li>`;
            } else {
                menuItemsHTML += `<hr><li><a href="login.html">ログイン</a></li>`;
            }
            menuList.innerHTML = menuItemsHTML;
            const logoutLink = document.getElementById('logout-link');
            if (logoutLink) {
                logoutLink.addEventListener('click', (event) => {
                    event.preventDefault();
                    sessionStorage.removeItem('loggedInUser');
                    alert('ログアウトしました。');
                    window.location.href = 'login.html';
                });
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            setupHamburgerMenu();
            const loggedInUser = sessionStorage.getItem('loggedInUser');
            if (!loggedInUser) {
                alert('ログインが必要です。');
                window.location.href = 'login.html';
                return;
            }
            document.getElementById('admin-title').textContent = loggedInUser + 'の管理ページ';

            const allData = JSON.parse(localStorage.getItem('bambooData')) || [];
            const listContainer = document.getElementById('bamboo-list');
            const bambooTypeMap = { 'moso': '孟宗竹', 'madake': '真竹', 'hachiku': '淡竹', 'other': 'その他' };
            const conditionMap = { 'managed': '手入れ済み', 'partial': '一部放置', 'abandoned': '完全放置' };

            const myData = [];
            allData.forEach((item, index) => {
                if (item['owner-name'] === loggedInUser) {
                    myData.push({ ...item, originalIndex: index });
                }
            });

            listContainer.innerHTML = '';
            if (myData.length > 0) {
                myData.forEach(data => {
                    const bambooTypeDisplay = bambooTypeMap[data['bamboo-type']] || data['bamboo-type'] || '';
                    const conditionDisplay = conditionMap[data['condition']] || data['condition'] || '';
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${data['address'] || ''}</td>
                        <td>${data['area'] || ''}</td>
                        <td>${bambooTypeDisplay}</td>
                        <td>${conditionDisplay}</td>
                        <td>
                            <a href="index.html?edit=${data.originalIndex}" class="action-btn edit-btn">修正</a>
                            <button class="action-btn delete-btn" data-index="${data.originalIndex}">削除</button>
                        </td>
                    `;
                    listContainer.appendChild(row);
                });
            } else {
                listContainer.innerHTML = `<tr><td colspan="5" style="text-align: center;">登録されたデータがありません。</td></tr>`;
            }

            listContainer.addEventListener('click', function(event) {
                if (event.target.classList.contains('delete-btn')) {
                    if (confirm('この情報を削除してもよろしいですか？')) {
                        const indexToDelete = event.target.dataset.index;
                        allData.splice(indexToDelete, 1);
                        localStorage.setItem('bambooData', JSON.stringify(allData));
                        location.reload();
                    }
                }
            });
        });
    </script>
</body>
</html>